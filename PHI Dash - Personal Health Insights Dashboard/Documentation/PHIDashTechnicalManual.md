# PHI Dash
## Technical Manual

### PHIDash Repository Contents
PHIDash_App - This directory includes the files for the main app. This folder is deployed on heroku and can be accessed via https://phidash.com \
PHIDash_RiskScoreModelDev - This directory includes the pythons scripts used to generate synthetic data and develop prediction models. \
PHIDash_Dashboards - This directory includes the CDC datasets and the Tableau workbooks. \

### Overview of the Main Scripts and Files

**In PHIDash_App**

*App.js*\
This file is a Node.js server application using the Express.js framework. It supports a web form that allows users to input their demographic and health data. 
The important functions it performs include:\
BMI Calculation: Calculates the user's Body Mass Index (BMI) using the user inputted weight and height.\
Age Group Determination: Determines the appropriate age groups to match the options for the Age Parameters in the Cancer and Heart Disease Tableau dashboards.\
Risk Score Assessment:  Executes the Python scripts to calculate the user's risk scores for cancer and heart disease.\
Tableau Dashboard URL Generation: It creates the links to each Tableau dashboard with the parameters matching the user information.\
Finally, it presents these calculated risk scores alongside hyperlinks to Tableau dashboards, that provides a personalized insight to the user.
((Working with Forms Using Express.js in Node.js, 2021), (Nose, 2024))

*form.ejs*\
Used by App.js to render the form through which the user enters their age, sex, race, weight, height, physical activity, and family history of cancer and heart disease.
(HTML Form – Input Type and Submit Button Example, 2021)

*results.ejs*\
Rendered by App.js to display the BMI, risk scores, and embedded personalized Tableau dashboards.

In PHIDash_App/RiskScoreCalc

cancer_risk_score.py and heart_risk_score.py\
The scripts are used to calculate the risk scores for cancer and heart disease. First the predictive model and scaler (accompanying joblib files in the directory) is loaded.
Then the user features are processed, first they are converted into floating point numbers, and then scaled using the scaler. The features are then fed into the model. 
The probability of the input features belonging to each category (0-low risk of disease, 1-high risk of disease) is returned. The probability of category 1 (high risk) is used to return low, medium, high scores. 
If the probability of 1 is less than or equal to 0.47 then its low risk score, if its above 0.53 then it's a high risk score. If the model returns a probability between 0.47 and 0.53, then it's a medium risk score.
(Bais, 2023)

**In PHIDash_RiskScoreModelDev**

*generate_cancer_data.py and generate_heart_data.py*\
These scripts are used to generate synthetic data for model development. Numpy functions are used to generate 2500 samples that include age, sex, bmi, physical activity, and family history.
The initial samples for bmi are generated from a normal distribution with a mean of 26.5 (CDC, 1960) and scale of 8.6, which was calculated by using the Empirical Rule and a maximum BMI of 52.3(NHS Inform, 2023).
The BMI values are then limited to values between BMI of 14.1 and 52.3. The physical activity is generated by basing the likelihood of each level of physical activity on the person's BMI.
Finally, the cancer occurrence is determined by calculating a risk score based on the above factors and then increasing probability of occurrence for higher risk scores.
The respective datasets are then generated as csv files.
(Klingensmith, 2024)

*cancer_risk_model.py and heart_risk_model.py*\
The dataset is loaded and then split based on features and the target. The features and target are then split into training and testing sets. Then the training and testing feature sets are scaled. 
Finally, the model is developed and saved as joblib files to be used by App.js and risk_score files to calculate risk scores. The model is also evaluated by checking its accuracy and confusion matrix. 
(Dharmaraj, 2022)

**In PHIDash_Dashboards**

*Datasets*\
This folder contains the CDC datasets for cancer (Centers for Disease Control and Prevention, n.d.) and heart disease (National Center for Health Statistics, n.d.) used to create the Tableau dashboards.

*Tableau workbooks*\
The Tableau workbooks include the sheets for the age,sex and race graphs, and an interactive graph that displays
data based on the parameters entered.
(Help and Training Community, n.d.)


**References:**
1. Working with forms using Express.js in Node.js. (2021, April 1). GeeksforGeeks. https://www.geeksforgeeks.org/working-with-forms-using-express-js-in-node-js/
2. Nose, L. (2024, January 18). Understanding Async/Await in Node.js. Postman Blog. https://blog.postman.com/understanding-async-await-in-node-js/
3. HTML Form – Input Type and Submit Button Example. (2021, August 12). FreeCodeCamp.org. https://www.freecodecamp.org/news/html-form-input-type-and-submit-button-example/
4. CDC. (1960). Healthy weight, overweight, and obesity among U.S. adults. https://www.cdc.gov/nchs/data/nhanes/databriefs/adultweight.pdf
5. NHS Inform. (2023). Body Mass Index (BMI). Www.nhsinform.scot. https://www.nhsinform.scot/healthy-living/food-and-nutrition/healthy-eating-and-weight-loss/body-mass-index-bmi/
6. Klingensmith, K. (2024, February 7). Build Your Own Synthetic Data. Medium. https://towardsdatascience.com/build-your-own-synthetic-data-15d91389a37b
7. SyntheticData/SyntheticDataBook.ipynb at main · kurtklingensmith/SyntheticData. (n.d.). GitHub. Retrieved April 21, 2024, from https://github.com/kurtklingensmith/SyntheticData/blob/main/SyntheticDataBook.ipynb
8. Dharmaraj. (2022, May 17). Logistic Regression with StandardScaler-From the Scratch. Medium. https://medium.com/@draj0718/logistic-regression-with-standardscaler-from-the-scratch-ec01def674e8
9. Bais, G. (2023, May 10). How to Save Trained Model in Python. Neptune.ai. https://neptune.ai/blog/saving-trained-model-in-python
10. Centers for Disease Control and Prevention. (n.d.). United States and Puerto Rico Cancer Statistics, 1999-2020 Incidence. Retrieved March 16, 2024, from https://wonder.cdc.gov/cancer-v2020.html
11. National Center for Health Statistics. (n.d.). Respondent-reported prevalence of heart disease in adults aged 18 and over, by selected characteristics: United States, selected years 1997-2019. Retrieved March 16, 2024, from https://www.cdc.gov/nchs/hus/data-finder.htm?&subject=Heart%20disease
12. Help And Training Community. (n.d.). Salesforce. Retrieved April 21, 2024, from https://help.salesforce.com/s/articleView?language=en_US&id=001458308&type=1
